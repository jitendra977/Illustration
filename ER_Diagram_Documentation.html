<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Illustration System - ER Diagram</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px;
            background-color: #f8f9fa;
        }
        .header {
            text-align: center;
            margin-bottom: 50px;
            border-bottom: 2px solid #007bff;
            padding-bottom: 20px;
        }
        h1 { color: #007bff; margin-bottom: 5px; }
        .version { color: #666; font-size: 0.9em; }
        .section {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 40px;
        }
        h2 { border-left: 5px solid #007bff; padding-left: 15px; margin-top: 0; color: #333; }
        .mermaid {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            background: #fff;
        }
        .footer {
            text-align: center;
            font-size: 0.8em;
            color: #999;
            margin-top: 50px;
        }
        @media print {
            body { background-color: white; padding: 0; }
            .section { box-shadow: none; border: 1px solid #ddd; }
            .no-print { display: none; }
        }
        .btn-print {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .btn-print:hover { background-color: #0056b3; }
    </style>
</head>
<body>

    <div class="header">
        <h1>Illustration System</h1>
        <p>Database Schema & Entity Relationship Diagram</p>
        <div class="version">Generated on: 2026-01-20</div>
    </div>

    <div class="no-print" style="text-align: right;">
        <button class="btn-print" onclick="window.print()">Save as PDF</button>
    </div>

    <div class="section">
        <h2>1. Account & Factory Architecture</h2>
        <p>This diagram shows the relationship between Users, Factories (Workspaces), and Permissions (Roles).</p>
        <div class="mermaid">
        erDiagram
            User ||--o{ FactoryMember : "belongs to"
            Factory ||--o{ FactoryMember : "has"
            Role ||--o{ FactoryMember : "defines permissions for"
            User ||--o{ Comment : "submits"

            User {
                string email PK
                string username
                string phone_number
                string profile_image
                boolean is_verified
                uuid verification_token
                datetime created_at
            }

            Factory {
                string name
                string address
                datetime created_at
            }

            Role {
                string code PK
                string name
                boolean can_manage_users
                boolean can_create_illustrations
            }

            FactoryMember {
                fk user_id
                fk factory_id
                fk role_id
                boolean is_active
            }

            Comment {
                string department_name
                string comment
                int star
                fk user_id
                datetime date
            }
        </div>
    </div>

    <div class="section">
        <h2>2. Vehicle Catalog & Illustrations</h2>
        <p>This diagram shows the relationship between Manufacturers, Engine Models, Car Models, and Part Categories.</p>
        <div class="mermaid">
        erDiagram
            Manufacturer ||--o{ EngineModel : "produces"
            Manufacturer ||--o{ CarModel : "produces"
            EngineModel }|--|{ CarModel : "installed in"
            PartCategory ||--o{ PartSubCategory : "contains"
            
            Illustration }|--|| User : "created by"
            Illustration }|--|| Factory : "belongs to"
            Illustration }|--|| EngineModel : "linked to engine"
            Illustration }|--|| PartCategory : "categorized by"
            Illustration }|--|o PartSubCategory : "sub-categorized by"
            Illustration }|--|{ CarModel : "applicable to cars"
            
            Illustration ||--o{ IllustrationFile : "contains files"
            User ||--o{ FavoriteIllustration : "bookmarks"
            Illustration ||--o{ FavoriteIllustration : "is bookmarked"

            Manufacturer {
                string name
                string slug
            }

            EngineModel {
                string name
                string engine_code
                string fuel_type
            }

            CarModel {
                string name
                string vehicle_type
                int year_from
                string model_code
                string chassis_code
            }

            PartCategory {
                string name
                string slug
            }

            PartSubCategory {
                string name
                string slug
            }

            Illustration {
                string title
                text description
                datetime created_at
            }

            IllustrationFile {
                file file
                string file_type
                string title
                datetime uploaded_at
            }

            FavoriteIllustration {
                fk user_id
                fk illustration_id
                datetime created_at
            }
        </div>
    </div>

    <div class="footer">
        &copy; 2026 Illustration System - Technical Documentation
    </div>

    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>
</body>
</html>
